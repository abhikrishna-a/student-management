{% extends 'base.html' %}

{% block title %}Student Dashboard - Student Management System{% endblock %}

{% block extra_css %}
<style>
    .dashboard-card {
        background: white;
        border: 1px solid #e2e8f0;
        transition: all 0.3s ease;
    }
    .dashboard-card:hover {
        border-color: #94a3b8;
        box-shadow: 0 20px 25px -5px rgba(0,0,0,0.05);
        transform: translateY(-2px);
    }
    .stat-card {
        background: white;
        border: 1px solid #e2e8f0;
        transition: all 0.3s ease;
    }
    .stat-card:hover {
        border-color: #0f172a;
        box-shadow: 0 10px 15px -3px rgba(15,23,42,0.1);
    }
    .course-item {
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        transition: all 0.2s ease;
    }
    .course-item:hover {
        border-color: #94a3b8;
        box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
    }
    .badge {
        background: #f1f5f9;
        color: #334155;
        font-size: 0.75rem;
        padding: 0.25rem 0.625rem;
        border-radius: 9999px;
        font-weight: 500;
    }
    .badge.success { background: #dcfce7; color: #166534; }
    .badge.warning { background: #fef9c3; color: #854d0e; }
    .badge.danger  { background: #fee2e2; color: #991b1b; }
    .progress-bar {
        background: #e2e8f0;
        border-radius: 9999px;
        overflow: hidden;
    }
    .progress-fill {
        background: #0f172a;
        height: 100%;
        border-radius: 9999px;
        transition: width 0.3s ease;
    }
</style>
{% endblock %}

{% block page_title %}Student Dashboard{% endblock %}
{% block page_subtitle %}Track your progress and manage courses{% endblock %}

{% block content %}

<!-- Welcome Banner -->
<div class="bg-slate-900 rounded-2xl p-8 mb-8 flex items-center justify-between">
    <div class="flex items-center gap-4">
        <div class="w-14 h-14 bg-white bg-opacity-10 rounded-full flex items-center justify-center border border-white border-opacity-20">
            <i class="bi bi-person-circle text-white text-3xl"></i>
        </div>
        <div>
            <h2 class="text-2xl font-bold text-white">
                Welcome, {{ request.user.first_name|default:request.user.username }}!
            </h2>
            <p class="text-slate-400 text-sm mt-1">
                {{ student.std_dept|default:"No Department" }} •
                Year {{ student.std_year_of_admission|default:"—" }}
            </p>
        </div>
    </div>
    <div class="text-right hidden sm:block">
        <div class="text-4xl font-bold text-white">{{ approved_courses.count }}</div>
        <div class="text-slate-400 text-sm">Approved Courses</div>
    </div>
</div>

<!-- Stats Grid -->
<div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
    <div class="stat-card p-5 rounded-xl border-l-4 border-slate-900">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center">
                <i class="bi bi-check-circle text-slate-900 text-xl"></i>
            </div>
            <div>
                <p class="text-xs text-slate-500">Approved</p>
                <h3 class="text-2xl font-bold text-slate-900">{{ approved_courses.count }}</h3>
            </div>
        </div>
    </div>

    <div class="stat-card p-5 rounded-xl border-l-4 border-slate-400">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center">
                <i class="bi bi-hourglass-split text-slate-600 text-xl"></i>
            </div>
            <div>
                <p class="text-xs text-slate-500">Pending</p>
                <h3 class="text-2xl font-bold text-slate-900">{{ pending_courses.count }}</h3>
            </div>
        </div>
    </div>

    <div class="stat-card p-5 rounded-xl border-l-4 border-slate-300">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center">
                <i class="bi bi-x-circle text-slate-500 text-xl"></i>
            </div>
            <div>
                <p class="text-xs text-slate-500">Rejected</p>
                <h3 class="text-2xl font-bold text-slate-900">{{ rejected_courses.count }}</h3>
            </div>
        </div>
    </div>

    <div class="stat-card p-5 rounded-xl border-l-4 border-slate-900">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center">
                <i class="bi bi-currency-rupee text-slate-900 text-xl"></i>
            </div>
            <div>
                <p class="text-xs text-slate-500">Total Spent</p>
                <h3 class="text-2xl font-bold text-slate-900">₹{{ total_spent }}</h3>
            </div>
        </div>
    </div>
</div>

<!-- Main Grid -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

    <!-- Left Column -->
    <div class="lg:col-span-2 space-y-6">

        <!-- Approved Courses -->
        <div class="dashboard-card rounded-xl p-6">
            <div class="flex items-center justify-between mb-5">
                <div class="flex items-center gap-2">
                    <i class="bi bi-check-circle text-slate-900 text-lg"></i>
                    <h3 class="text-lg font-semibold text-slate-900">My Approved Courses</h3>
                </div>
                <span class="px-3 py-1 bg-slate-900 text-white text-xs font-semibold rounded-full">
                    {{ approved_courses.count }} courses
                </span>
            </div>

            <div class="space-y-3">
                {% for item in approved_courses %}
                <div class="course-item p-4 border-l-4 border-slate-900">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center">
                                <i class="bi bi-book text-slate-700"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-slate-900 text-sm">{{ item.course.course_name }}</h4>
                                <p class="text-xs text-slate-500 uppercase tracking-wide">
                                    {{ item.course.department|default:"General" }}
                                </p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-bold text-slate-900">{{ item.course.formatted_price }}</div>
                            <span class="badge success text-xs mt-1 inline-block">
                                <i class="bi bi-check-circle me-1"></i>Approved
                            </span>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-12 bg-slate-50 rounded-xl border border-slate-200">
                    <div class="w-16 h-16 bg-slate-200 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="bi bi-book text-slate-400 text-2xl"></i>
                    </div>
                    <h4 class="font-semibold text-slate-600 mb-1">No Approved Courses Yet</h4>
                    <p class="text-sm text-slate-400 mb-4">You don't have any approved courses yet.</p>
                    <a href="{% url 'purchase_course' %}"
                       class="inline-flex items-center gap-2 px-4 py-2 bg-slate-900 text-white text-sm rounded-lg hover:bg-slate-800 transition-colors">
                        <i class="bi bi-cart"></i> Browse Courses
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Pending Courses -->
        <div class="dashboard-card rounded-xl p-6">
            <div class="flex items-center justify-between mb-5">
                <div class="flex items-center gap-2">
                    <i class="bi bi-hourglass-split text-slate-600 text-lg"></i>
                    <h3 class="text-lg font-semibold text-slate-900">Pending Approval</h3>
                </div>
                {% if pending_courses.count %}
                <span class="w-7 h-7 bg-slate-900 text-white text-xs font-bold rounded-full flex items-center justify-center">
                    {{ pending_courses.count }}
                </span>
                {% endif %}
            </div>

            <div class="space-y-3">
                {% for item in pending_courses %}
                <div class="course-item p-4 border-l-4 border-slate-400">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center">
                                <i class="bi bi-hourglass-split text-slate-500 text-sm"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-slate-900 text-sm">{{ item.course.course_name }}</h4>
                                <p class="text-xs text-slate-500 uppercase tracking-wide">
                                    {{ item.course.department|default:"General" }}
                                </p>
                            </div>
                        </div>
                        <span class="badge warning text-xs">
                            <i class="bi bi-info-circle me-1"></i>Waiting
                        </span>
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-8 bg-slate-50 rounded-xl border border-slate-200">
                    <i class="bi bi-hourglass text-slate-300 text-3xl mb-2 block"></i>
                    <p class="text-sm text-slate-400">No pending courses</p>
                </div>
                {% endfor %}
            </div>
        </div>

    </div>

    <!-- Right Column -->
    <div class="space-y-6">

        <!-- Rejected Courses Card -->
        <div class="dashboard-card rounded-xl p-6">
            <div class="flex items-center justify-between mb-5">
                <div class="flex items-center gap-2">
                    <i class="bi bi-x-circle text-slate-500 text-lg"></i>
                    <h3 class="text-lg font-semibold text-slate-900">Rejected Courses</h3>
                </div>
                <span class="w-7 h-7 bg-slate-900 text-white text-xs font-bold rounded-full flex items-center justify-center">
                    {{ rejected_courses.count }}
                </span>
            </div>

            <div class="space-y-3">
                {% for item in rejected_courses %}
                <div class="course-item p-4 border-l-4 border-slate-300">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center">
                                <i class="bi bi-x-circle text-slate-400"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-slate-900 text-sm">{{ item.course.course_name }}</h4>
                                <p class="text-xs text-slate-500 uppercase tracking-wide">
                                    {{ item.course.department|default:"General" }}
                                </p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-bold text-slate-400 line-through">{{ item.course.formatted_price }}</div>
                            <span class="badge danger text-xs mt-1 inline-block">
                                <i class="bi bi-x-circle me-1"></i>Rejected
                            </span>
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-t border-slate-100">
                        <a href="{% url 'purchase_course' %}"
                           class="text-xs text-slate-600 hover:text-slate-900 flex items-center gap-1 transition-colors">
                            <i class="bi bi-arrow-repeat"></i> Request again
                        </a>
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-10 bg-slate-50 rounded-xl border border-slate-200">
                    <div class="w-14 h-14 bg-slate-200 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="bi bi-x-circle text-slate-400 text-2xl"></i>
                    </div>
                    <h4 class="font-semibold text-slate-500 mb-1">No Rejected Courses</h4>
                    <p class="text-xs text-slate-400">All your requests are in good standing.</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Recent Purchases -->
        <div class="dashboard-card rounded-xl p-6">
            <h3 class="text-lg font-semibold text-slate-900 mb-4">Recent Purchases</h3>
            <div class="space-y-3">
                {% for item in enrolled_courses|slice:":5" %}
                <div class="flex items-center gap-3 p-3 hover:bg-slate-50 rounded-lg transition-colors">
                    <div class="w-2 h-2 rounded-full flex-shrink-0
                        {% if item.status == 'APPROVED' %}bg-slate-900
                        {% elif item.status == 'PENDING' %}bg-slate-400
                        {% else %}bg-slate-300{% endif %}">
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-slate-900 truncate">{{ item.course.course_name }}</p>
                        <p class="text-xs text-slate-400">{{ item.purchased_at|date:"d M Y" }}</p>
                    </div>
                    <span class="text-xs font-medium
                        {% if item.status == 'APPROVED' %}text-slate-900
                        {% elif item.status == 'PENDING' %}text-slate-500
                        {% else %}text-slate-400{% endif %}">
                        {{ item.status }}
                    </span>
                </div>
                {% empty %}
                <div class="text-center py-6">
                    <i class="bi bi-bag text-slate-300 text-3xl mb-2 block"></i>
                    <p class="text-sm text-slate-400">No purchases yet</p>
                </div>
                {% endfor %}
            </div>
            <a href="{% url 'purchase_course' %}"
               class="block text-center text-sm text-slate-500 hover:text-slate-900 mt-4 pt-3 border-t border-slate-100 transition-colors">
                Browse more courses <i class="bi bi-arrow-right ms-1"></i>
            </a>
        </div>

    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Dashboard loaded');
    });
</script>
{% endblock %}